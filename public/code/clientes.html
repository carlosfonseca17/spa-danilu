<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes</title>
    <link rel="stylesheet" href="/public/css/styles.css">
</head>
<body>
    <div class="container">
        <h2>Registro de Clientes</h2>
        <form id="cliente-form">
            <label for="id_cliente">ID Cliente:</label>
            <input type="text" id="id_cliente" name="id_cliente" required>

            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="correo">Correo Electr√≥nico:</label>
            <input type="email" id="correo" name="correo" required>

            <label for="telefono">N√∫mero de Tel√©fono:</label>
            <input type="tel" id="telefono" name="telefono" required>
            
            <label for="contrasena">Contrase√±a:</label>
            <input type="password" id="contrasena" name="contrasena" required>

            <button type="submit" class="btn-submit">Guardar Cliente</button>
        </form>
    </div>

    <div id="mensaje" class="mensaje"></div>
    <div id="status-message" class="status-message"></div>
    <script>
 // Funci√≥n para mostrar/ocultar contrase√±a
 function togglePassword() {
            const input = document.getElementById('contrasena');
            const toggle = document.querySelector('.password-toggle');
            if (input.type === 'password') {
                input.type = 'text';
                toggle.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
            } else {
                input.type = 'password';
                toggle.textContent = 'üëÅÔ∏è';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('cliente-form');
            const idInput = document.getElementById('id_cliente');
            const correoInput = document.getElementById('correo');
            const mensajeDiv = document.getElementById('mensaje');
            const statusDiv = document.getElementById('status-message');

            // Verificaci√≥n en tiempo real
            idInput.addEventListener('blur', checkExistingClient);
            correoInput.addEventListener('blur', checkExistingClient);

            async function checkExistingClient() {
                const id = idInput.value.trim();
                const correo = correoInput.value.trim();
                
                if (!id && !correo) return;
                
                try {
                    const response = await fetch(`http://localhost:3000/api/clientes/existe/${id || correo}`);
                    const data = await response.json();
                    
                    if (data.existe) {
                        showStatusMessage('‚ö†Ô∏è Este cliente ya est√° registrado', 'warning');
                    } else {
                        showStatusMessage('', '');
                    }
                } catch (error) {
                    console.error('Error al verificar:', error);
                    showStatusMessage('Error al verificar cliente', 'error');
                }
            }

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const cliente = {
                    id_cliente: idInput.value.trim(),
                    nombre: document.getElementById('nombre').value.trim(),
                    correo: correoInput.value.trim(),
                    telefono: document.getElementById('telefono').value.trim(),
                    contrasena: document.getElementById('contrasena').value
                };
                
                // Validaci√≥n b√°sica
                if (!cliente.id_cliente || !cliente.nombre || !cliente.correo || !cliente.telefono || !cliente.contrasena) {
                    showMessage('Por favor complete todos los campos', 'error');
                    return;
                }
                
                if (cliente.contrasena.length < 8) {
                    showMessage('La contrase√±a debe tener al menos 8 caracteres', 'error');
                    return;
                }
                
                try {
                    const response = await fetch('http://localhost:3000/api/clientes', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(cliente)
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showMessage(data.message, 'success');
                        form.reset();
                        showStatusMessage('', '');
                    } else {
                        showMessage(data.message, 'error');
                    }
                } catch (error) {
                    showMessage('Error al conectar con el servidor', 'error');
                    console.error('Error:', error);
                }
            });
            
            function showMessage(text, type) {
                mensajeDiv.textContent = text;
                mensajeDiv.className = `mensaje ${type}`;
                setTimeout(() => {
                    mensajeDiv.textContent = '';
                    mensajeDiv.className = 'mensaje';
                }, 5000);
            }
            
            function showStatusMessage(text, type) {
                statusDiv.textContent = text;
                statusDiv.className = type ? `mensaje ${type}` : '';
            }
        });
    </script>
</html>
