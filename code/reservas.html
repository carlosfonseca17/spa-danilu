<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reservas</title>
  <link rel="stylesheet" href="/public/css/styles.css">
</head>
<body>
  <div class="container">
    <h2>Registro de Reservas</h2>
    <form id="reserva-form">
      <label for="id_rese">ID de Reserva:</label>
      <input type="text" id="id_rese" name="id_rese" required>

      <label for="fec_rese">Fecha de Reserva:</label>
      <input type="date" id="fec_rese" name="fec_rese" required>

      <label for="hor_rese">Hora de Reserva:</label>
      <input type="time" id="hor_rese" name="hor_rese" required>

      <label for="val_rese">Valor de la Reserva ($):</label>
      <input type="number" id="val_rese" name="val_rese" required>

      <label for="id_clie">ID Cliente:</label>
      <input type="text" id="id_clie" name="id_clie" required
             pattern="[A-Za-z0-9]{8,20}" 
             title="El ID debe contener entre 8-20 caracteres alfanuméricos">

      <button type="submit">Guardar Reserva</button>
    </form>
    <p id="mensaje"></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('reserva-form');
      const mensaje = document.getElementById('mensaje');
      const cliente = JSON.parse(localStorage.getItem('usuario'));


      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!cliente || !cliente.id_cli) {
          mensaje.textContent = 'No se encontró un cliente logueado.';
          return;
        }

        const reserva = {
          id_rese: document.getElementById('id_rese').value,
          fec_rese: document.getElementById('fec_rese').value,
          hor_rese: document.getElementById('hor_rese').value,
          val_rese: document.getElementById('val_rese').value,
          id_clie: cliente.id_cli
        };

        try {
          const response = await fetch('http://localhost:3000/api/reservas', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(reserva)
          });

          const data = await response.json();
          if (data.success) {
            mensaje.textContent = 'Reserva guardada con éxito';
            form.reset();
          } else {
            mensaje.textContent = data.message || 'No se pudo guardar';
          }
        } catch (error) {
          console.error(error);
          mensaje.textContent = 'Error al conectar con el servidor';
        }
      });
    });
  </script>
</body>
</html>
